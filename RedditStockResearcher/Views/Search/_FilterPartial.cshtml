@model SearchModel
@*Had to copy and paste script from site.js for the delete button feature.*@
<script>

    $("button[id*='delete']").click(function (event) {
        var subToRem = this.parentElement.id;

        if (confirm("Remove " + subToRem + "?")) {
            var ticker = $("#tickerHeader").text();
            doRemoveSubreddit(subToRem, ticker);
            $("#" + subToRem + "Card").remove();
        }
    })

    function doRemoveSubreddit(subToRem, ticker) {

        $.ajax({
            method: "GET",
            url: "/Search/RemoveSubreddit",
            data: {
                "remSub": subToRem,
                "ticker": ticker
            }
        });
    }


</script>

@*This html will place that in the index page, displays updated data without needing to refresh the page.*@
@*Start displaying posts*@
@if (Model.PostDict != null)
{
    <div class="accordion" id="stockAccordion">
        @foreach (var item in Model.PostDict)
        {
            var subName = (@item.Key);

            <div class="card mb-3" id="@(subName)Card">

                <div class="card-header" id="@(subName)Header">


                    <div id="@(subName)" class="position-relative mb-0 d-flex" style="background-color: @Model.SubredditColors[item.Key]">

                        <button class="btn btn-link w-100 p-3" type="button" aria-expanded="false" data-toggle="collapse"
                                data-target="#@(subName)Collapse" aria-controls="@(subName)Collapse" style="text-decoration: none">
                            <h3 class="text-center" style="color: white">
                                <img src="@Url.Content(Model.SubredditImages[item.Key])" width="32" height="32" />
                                @("r/" + @item.Key)
                                <img src="@Url.Content(Model.SubredditImages[item.Key])" width="32" height="32" />
                            </h3>
                        </button>

                        <button id="delete@(subName)" class="btn btn-danger btn-sm" style="position: absolute; top:0; right:0; transform: translate(30%, -20%);">
                            X
                        </button>


                    </div>






                    <div id="@(subName)Collapse" class="collapse" aria-labelledby="@(subName)Header" data-parent="#stockAccordion">
                        @foreach (Reddit.Controllers.Post post in item.Value)
                        {
                            <div class="card-body">

                                <div class="d-flex justify-content-between p-3 mb-2 bg-dark">
                                    <div class="p-2 mr-auto ml-0 pr-lg-4 pl-0 align-self-center">
                                        <div class="p-2 pl-0 w-100">
                                            <p class="d-inline p-1 pr-md-1 text-white">@post.UpVotes</p>
                                            <img class="mb-2 d-inline" src="~/images/upvote-trans.png" alt="upvoteimg" width="24" height="24" />
                                        </div>
                                        <div class="p-2 pl-0 w-100">
                                            <p class="d-inline p-1 pr-md-1 text-white">@post.Listing.NumComments</p>
                                            <img src="~/images/commentimg.png" alt="commentimg" width="24" height="24" />
                                        </div>
                                    </div>
                                    <div class="p-2 ml-lg-5 align-self-center">
                                        <a href="https://www.reddit.com@(post.Listing.Permalink)">
                                            <h5 class="text-white justify-content-center text-center">
                                                @post.Listing.Title
                                            </h5>
                                        </a>
                                    </div>

                                    <div class="p-2 ml-auto align-self-center">
                                        <p class="text-right" style="color: lightgray">@Model.PostsTimePassedStrings[post].Item2</p>
                                        <p class="text-right font-italic text-muted">@Model.PostsTimePassedStrings[post].Item1</p>
                                    </div>
                                </div>

                                @Html.Raw(post.Listing.SelfTextHTML)
                                @if (@post.Listing.IsRedditMediaDomain)
                                {

                                    <img class="img-fluid w-50 h-50 modal-open" src="@(post.Listing.URL)" alt="post image" />
                                }

                            </div>
                        }
                    </div>
                </div>
            </div>

        }
    </div>


}
